{% extends 'home/base.html' %}

{% block content %}
<div class="container py-5">
    <!-- Target / Reference Corpus Selector Section -->
    <div class="row mb-5">
        <div class="col-md-6 mx-auto">
            <div class="card shadow-sm border-0 rounded-lg">
                <div class="card-body">
                    <form method="GET" class="mb-0">
                        <div class="form-group mb-0">
                            <label for="compareTo" class="form-label fw-bold mb-2">Selected text:</label>
                            <select class="form-select form-select-lg shadow-sm" id="compareTo" name="compare_to" onchange="this.form.submit()">
                                <option value="most-recent" {% if target == 'most-recent' %}selected{% endif %}>My most recent reflection</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-6 mx-auto">
            <div class="card shadow-sm border-0 rounded-lg">
                <div class="card-body">
                    <form method="GET" class="mb-0">
                        <div class="form-group mb-0">
                            <label for="compareTo" class="form-label fw-bold mb-2">Comparing to:</label>
                            <select class="form-select form-select-lg shadow-sm" id="compareTo" name="compare_to" onchange="this.form.submit()">
                                <option value="none-selected" {% if compare_to == '' %}selected{% endif %}>None selected</option>
                                <option value="previous" {% if compare_to == 'previous' %}selected{% endif %}>üìù My previous reflections</option>
                                <option value="class" {% if compare_to == 'class' %}selected{% endif %}>üë• Users in my class</option>
                                <option value="all" {% if compare_to == 'all' %}selected{% endif %}>üåê All users</option>
                                <option value="michigan" {% if compare_to == 'michigan' %}selected{% endif %}>üéì Michigan Engineering Corpus</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Analysis Cards -->
    <div class="row g-4">
        <div class="col-md-6">
            <div class="card shadow border-0 rounded-lg h-100">
                <div class="card-header bg-white py-3">
                    <h2 class="card-title h5 mb-0 fw-bold">Word Frequency Analysis</h2>
                </div>
                <div class="card-body position-relative">
                    {% if word_frequencies %}
                        <div class="analysis-content">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th scope="col" class="fw-bold">Word</th>
                                        <th scope="col" class="fw-bold">Frequency</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for word, count in word_frequencies.items %}
                                    <tr>
                                        <td>{{ word }}</td>
                                        <td><span class="badge bg-primary rounded-pill">{{ count }}</span></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-chart-bar fa-3x mb-3"></i>
                            <p class="mb-0">No reflection data available yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow border-0 rounded-lg h-100">
                <div class="card-header bg-white py-3">
                    <h2 class="card-title h5 mb-0 fw-bold">Keyness Analysis</h2>
                </div>
                <div class="card-body position-relative">
                    {% if keyness_table %}
                        <div class="analysis-content">
                            {{ keyness_table|safe }}
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <i class="fas fa-calculator fa-3x mb-3"></i>
                            <p class="mb-0">No reflection data available yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}